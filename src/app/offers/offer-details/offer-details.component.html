<div *ngIf="isOverview">
    <app-header></app-header>
</div>

<div *ngIf="{
    project: project$ | async,
    walletMW: projectWalletMW$ | async,
    news: news$ | async,
    user: user$ | async
} as states" class="wow fadeIn container" style="background: #fdfdfd">
    <div class="app-page-title-back" (click)="backToOffersScreen()">
        <i class="fas fa-long-arrow-alt-left mr-3"></i>
        OFFER DETAILS
    </div>

    <div class="row" *ngIf="states.project !== null else overlaySpinner">
        <!-- Closed project popup -->
        <div *ngIf="!states.project.active" class="col-lg-12 mb-3">
            <div class="alert alert-danger">
                The project is not open for funding. If you wish to invest, please check project at a
                later date.
            </div>
        </div>
        
        <!-- <div class="col-lg-7 offer-left order-last order-lg-second"> -->
        <div class="offer-left col-lg-7">
            <!-- Offer image -->
            <!-- <div class="wow fadeIn d-lg-block d-none"> -->
            <div class="wow fadeIn">
                <!-- <img class="header-image w-100" src="{{states.project.main_image}}"> -->
                <img class="left__img w-100" src="{{states.project.main_image}}">
            </div>
        </div>

        <!-- <div class="col-12 col-lg-5 offer-right order-second order-lg-last"> -->
        <div class="offer-right col-lg-5">
            <!-- <div class="offer-right-container"> -->
            <div class="right__container">
                <!-- Offer image for mobile -->
                <!-- <div class="offer-right-text col-lg-9"> -->
                <div class="right__text">
                    <!-- Offer title -->
                    <div>
                        <!-- <h3 class="pt-lg-5 pt-4 offer-title">{{ states.project.name }}</h3> -->
                        <h1 class="app-basic-title">{{ states.project.name }}</h1>
                    </div>

                    <!-- Offer location -->
                    <!-- <div class="mt-4 offer-location"> -->
                    <div class="right__location">
                        <p (click)="openModal(states.project)">
                            <!-- <i class="fas fa-map-marker-alt mr-2"></i> -->
                            <i class="fas fa-map-marker-alt"></i>
                            Show location
                        </p>
                        {{ states.project.location_text }}
                    </div>

                    <!-- Offer progress -->
                    <!-- <div class="progress-text"> -->
                    <div class="right__progress-text">
                        <!-- <p class="mt-lg-5 mt-4"> -->
                        <p>
                            <ng-container *ngIf="!!states.walletMW else smallSpinner">
                                <span>{{ states.walletMW.totalFundsRaised | currencyDefault }}</span> raised of
                                <span>{{ states.walletMW.investmentCap | currencyDefault }}</span> goal
                            </ng-container>
                        </p>
                    </div>
                    <!-- <div class="progress"> -->
                    <div class="right__progress">
                        <div [style.width.%]="(states.walletMW?.totalFundsRaised / states.walletMW?.investmentCap) * 100"
                             class="progress-bar progress__bar"
                             role="progressbar">
                        </div>
                    </div>

                    <!-- Offer return rate -->
                    <!-- <div class="offer-return"> -->
                    <div class="right__return-rate">
                        <span>{{ states.project.roi.from }}% - {{ states.project.roi.to }}%</span>
                        Expected yearly return
                    </div>
                    <!-- <div class="dropdown-divider mt-lg-3"></div> -->
                    <div class="dropdown-divider"></div>

                    <!-- Offer min investment -->
                    <div class="right__min-invest">
                        <span>{{ states.project.min_per_user | currencyDefault }}</span>Min Investment
                    </div>
                    <!-- <div class="dropdown-divider mt-lg-3"></div> -->
                    <div class="dropdown-divider"></div>

                    <!-- Offer max investment -->
                    <!-- <div class="mt-lg-3"> -->
                    <div class="right__max-invest">
                        <span>{{ states.project.max_per_user | currencyDefault }}</span>Max Investment
                    </div>
                    <!-- <div class="dropdown-divider mt-lg-3"></div> -->
                    <div class="dropdown-divider"></div>

                    <!-- Offer funding period -->
                    <!-- <div class="mt-lg-3 pb-lg-5 pb-0"> -->
                    <div class="right__fund-period">
                        <span>Funding period</span>
                        {{ states.project.start_date | date:'mediumDate' }}
                        - {{ states.project.end_date | date:'mediumDate' }}
                    </div>

                    <!-- Offer Invest btn -->
                    <!-- <div class="invest-button-holder d-none d-lg-block"> -->
                        <div class="right__invest">
                            <button *ngIf="isOverview" class="btn btn-primary w-100 btn-action-a"
                                    id="invest-button"
                                    routerLink="/sign_up">
                                <i class="mr-2 fas fa-chart-pie"></i>
                                Sign Up & Invest
                            </button>
    
                            <div *ngIf="!isOverview && !!states.user">
                                <button *ngIf="states.user.verified"
                                        [disabled]="disableInvestButton(states.project, states.walletMW)"
                                        class="btn btn-primary w-100 btn-action-a" id="invest-button"
                                        (click)="goToInvest(states.project.uuid)">
                                    <i class="mr-2 fas fa-chart-pie"></i>
                                    Invest
                                </button>
                                <button *ngIf="!states.user.verified" [disabled]="!states.project.active"
                                        class="btn btn-primary w-100 btn-action-a"
                                        id="invest-button"
                                        routerLink="/dash/general_settings">
                                    <i class="mr-2 fas fa-chart-pie"></i>
                                    Verify Profile & Invest
                                </button>
                            </div>
                        </div>

                    <!-- Offer Invest btn for mobile -->
                    <!-- <div class="invest-button-holder d-block d-lg-none">

                        <button *ngIf="isOverview" class="btn btn-primary w-100 btn-action-a"
                                id="invest-button"
                                routerLink="/sign_up">
                            <i class="mr-2 fas fa-chart-pie"></i>
                            Sign Up & Invest
                        </button>

                        <div *ngIf="!isOverview && !!states.user">
                            <button *ngIf="states.user.verified"
                                    [disabled]="disableInvestButton(states.project, states.walletMW)"
                                    class="btn btn-primary w-100 btn-action-a" id="invest-button"
                                    routerLink="invest">
                                <i class="mr-2 fas fa-chart-pie"></i>
                                Invest
                            </button>
                            <button *ngIf="!states.user.verified" [disabled]="!states.project.active"
                                    class="btn btn-primary w-100 btn-action-a"
                                    id="invest-button"
                                    routerLink="/dash/general_settings">
                                <i class="mr-2 fas fa-chart-pie"></i>
                                Verify Profile & Invest
                            </button>
                        </div>
                    </div> -->
                </div>
            </div>

            <!-- Offer socials share -->
            <div class="offer-right-socials col-lg-9">
                <div class="d-flex flex-row align-items-center">
                    <span class="mr-lg-5">Share</span>
                    <div class="cursor-pointer mr-lg-5">
                        <a href="https://twitter.com/intent/tweet?url={{ getProjectURL(states.project.uuid) }}"
                           target="_blank">
                            <i class="fab fa-twitter"></i>
                        </a>
                    </div>
                    <div class="cursor-pointer mr-lg-5">
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ getProjectURL(states.project.uuid) }}"
                           target="_blank">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                    </div>
                    <div class="cursor-pointer" #copyToClipboard="bs-tooltip"
                         (click)="copyProjectDetailsUrl(copyToClipboard, states.project.uuid)"
                         tooltip="Copied to clipboard."
                         triggers="">
                        <i class="fas fa-link"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="offer-left col-lg-7">
            <!-- Offer desc -->
            <!-- <div class="left-desc"> -->
            <div class="left__desc">
                <div [innerHTML]="states.project.description"></div>
            </div>
            <!-- Offer docs -->
            <!-- <div class="offer-docs mb-5 mb-lg-3"> -->
            <div class="offer__docs">
                <div *ngFor="let doc of states.project.documents" class="w-100 mt-4">
                    <!-- <div class="d-flex flex-row align-items-center"> -->
                    <div class="docs__links">
                        <a href="{{ doc.link }}">
                            <i class="fas fa-file-download mr-2"></i>
                            <span>{{ doc.name }}</span>
                        </a>
                        <!-- <div class="w-75"
                             style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{ doc.name }}
                        </div> -->
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<ng-template #overlaySpinner>
    <app-spinner type="overlay"></app-spinner>
</ng-template>

<ng-template #smallSpinner>
    <span>
        <app-spinner type="inline"></app-spinner>
    </span>
</ng-template>
