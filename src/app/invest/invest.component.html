<div *ngIf="{
    project: project$ | async,
    projectWallet: projectWalletMW$ | async,
    investment: investment$ | async
} as states" class="container">
    <ng-container *ngIf="states.investment !== null && states.project !== null else spinner">
        <div class="row">
            <div class="app-page-title-back" (click)="backToSingleOfferScreen(states.project.uuid)">
                <i class="fas fa-long-arrow-alt-left mr-3"></i>
                Invest in
            </div>
            <div class="invest col-12">
                <h1 class="app-basic-title">{{ states.project.name }}</h1>
                <div class="dropdown-divider"></div>

                <div class="invest__content">
                    <div class="invest__text-left col-lg-6">
                        <div class="invest__input-label">
                            <p>I want to invest</p>
                            <app-money-input-field
                                    placeholder="Enter invest amount"
                                    [control]="investForm.get('amount')"
                                    inputClass="input-lg w-100 invest">
                            </app-money-input-field>
                        </div>

                        <div class="invest__range-labels">
                            <p>{{ minUserInvest | currencyDefault }} Min investment</p>
                            <p>{{ maxUserInvest | currencyDefault }} Max investment</p>
                        </div>

                    </div>

                    <div class="col-lg-4 invest__button">
                        <button (click)="investButtonClicked()"
                                [disabled]="!investForm.valid"
                                type="submit"
                                class="btn btn-primary w-100">
                            <i class="fas fa-chart-pie mr-2"></i>
                            Invest
                        </button>
                    </div>

                    <div class="col-lg-2 invest__text-right">
                        <p class="right__available">Available funds</p>
                        <p class="right__amount">{{ states.investment.walletBalance | currencyDefault }}</p>
                        <a class="right__link" [routerLink]="'/dash/wallet' | coopPath">Open wallet</a>
                    </div>
                </div>
            </div>

            <div class="error-messages col-12 col-lg-8" *ngIf="investForm.dirty && investForm.invalid">
                <div *ngIf="investForm.get('amount').errors?.amountBelowMin" class="alert alert-danger flex__center">
                    <i class="fas fa-dizzy"></i>
                    <b>Investment amount too low.&nbsp;</b>
                    <span>
                        The minimum investment is {{ minUserInvest | currencyDefault }}
                    </span>
                </div>

                <div *ngIf="investForm.get('amount').errors?.amountAboveMax" class="alert alert-danger flex__center">
                    <i class="fas fa-dizzy"></i>
                    <b>Investment amount too high.&nbsp;</b>
                    <span>
                        The maximum investment is {{ maxUserInvest | currencyDefault }}
                    </span>
                </div>

                <div *ngIf="investForm.get('amount').errors?.amountAboveExpFunding"
                     class="alert alert-danger flex__center">
                    <i class="fas fa-dizzy"></i>
                    <b>Investment amount too high.&nbsp;</b>
                    <span>
                        The expected funding for this project is {{ states.project.expected_funding | currencyDefault }}
                    </span>
                </div>

                <div *ngIf="investForm.get('amount').errors?.totalProjInvestAboveMax"
                     class="alert alert-danger flex__center">
                    <i class="fas fa-dizzy"></i>
                    <b>Total investments too high.&nbsp;</b>
                    <span>
                        The maximum investments is {{ maxUserInvest | currencyDefault }}
                    </span>
                </div>

                <div *ngIf="investForm.get('amount').errors?.amountAboveBalance"
                     class="alert alert-danger flex__center-space">
                    <div class="flex__center">
                        <i class="fas fa-dizzy"></i>
                        <b>You don't have enough funds on your wallet</b>
                    </div>
                    <button class="btn btn-danger" [routerLink]="'/dash/wallet' | coopPath">Please deposit funds</button>
                    <button class="btn btn-danger btn-mobile" [routerLink]="'/dash/wallet' | coopPath">Deposit</button>
                </div>
            </div>
        </div>

        <div *ngIf="maxInvestReached"
             class="alert alert-danger flex__center">
            <i class="fas fa-dizzy"></i>
            <b>You have already invested a maximum allowed amount for this project..&nbsp;</b>
        </div>

    </ng-container>

    <ng-container *ngIf="investForm.valid && investForm.get('amount').value">
        <div class="estimated-calculator">
            <div class="estimated__return-label">
                <p>ESTIMATED RETURN</p>
            </div>

            <div class="estimated__content">
                <div>
                    <div class="estimated__total-label col-lg-12">
                        <h2>Total investment = {{ totalInvestment | currencyDefault }}</h2>
                    </div>
                    <div class="estimated__invested-label col-lg-12">
                        <p>{{ states.investment.amountInvested  | currencyDefault }} invested so far </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg">
                        <div class="estimated__return-header">
                            <div class="estimated__header-label col-lg"><p>Return over 1 year</p></div>
                        </div>
                        <div class="return__amounts">
                            <div class="estimated__amount-label col-lg"><p>{{ oneYearReturn }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg">
                        <div class="estimated__return-header">
                            <div class="estimated__header-label col-lg"><p>5 Years</p></div>
                        </div>
                        <div class="return__amounts">
                            <div class="estimated__amount-label col-lg"><p>{{ fiveYearsReturn }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg">
                        <div class="estimated__return-header">
                            <div class="estimated__header-label col-lg"><p>10 Years</p></div>
                        </div>
                        <div class="return__amounts">
                            <div class="estimated__amount-label col-lg"><p>{{ tenYearsReturn }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="funds__bottom">
            <div class="dropdown-divider"></div>
            <div class="row row-cols-2">
                <p class="right__available">Available funds</p>
                <h2>{{ states.investment.walletBalance | currencyDefault }}</h2>
                <a class="right__link" routerLink="/dash/wallet">Open wallet</a>
            </div>
        </div>
    </ng-container>
</div>

<ng-template #spinner>
    <app-spinner type="overlay"></app-spinner>
</ng-template>
